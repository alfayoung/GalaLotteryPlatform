import{u as v,r as h,g as x,o as A,a as w,b as d,c as k,w as _,d as r,e as o,f as y,_ as J,h as g,i as u,j as f,k as P,v as S,F as j,E as N}from"./index-e57c21a1.js";import{_ as B}from"./speit-2d09ae7d.js";const L=o("br",null,null,-1),T={__name:"JAccountLogin",setup(c){const t=v(),l=h(null),{proxy:e}=x(),p=()=>{localStorage.setItem("redirect_uri",window.location.href),console.log(localStorage.getItem("redirect_uri")),e.$axios.get("/api/getAuthorizationCode",{params:{redirect_uri:localStorage.getItem("redirect_uri")}}).then(n=>{window.location.href=n.data}).catch(n=>{console.log(n)})},m=async()=>{const i=new URLSearchParams(window.location.search).getAll("code");if(i.length>0){const s=i[i.length-1];await e.$axios.get("/api/getProfile",{params:{code:s,redirect_uri:localStorage.getItem("redirect_uri")}}).then(a=>{l.value=a.data,t.updateuserName(a.data.entities[0].name),t.updateJAccount(a.data.entities[0].code),t.updatelogin(!0),t.updateis_admin(!1),console.log(a.data)}).catch(a=>{console.log(a)}),await e.$axios.post("/api/registerUser",null,{params:{jAccount:t.jAccount,name:t.userName}}),await e.$axios.get("/api/getUserProfile",{params:{jAccount:t.jAccount}}).then(a=>{const b=btoa(new Uint8Array(a.data).reduce((C,I)=>C+String.fromCharCode(I),""));t.updateHead("data:image/png;base64,"+b)}),y.push("/cjmobile")}};return A(async()=>{await m()}),(n,i)=>{const s=w("el-button");return d(),k(s,{type:"primary",class:"login-button",onClick:p},{default:_(()=>[r("Jaccount登录"),L,r("Connexion Jaccount")]),_:1})}}};const U={components:{JAccountLogin:T},setup(){const c=v(),t=h(!1),{proxy:l}=x(),e=h("");return{showInput:t,saveText:()=>{c.updateinputText(document.getElementById("myInput").value)},enter:()=>{console.log(e.value),l.$axios.get("/api/checkPassword",{params:{password:e.value}}).then(n=>{n.data?(c.updateis_admin(!0),c.updatelogin(!0),y.push("/home")):N.error("密码错误")}),c.logout()},password:e}}},V=o("div",null,[o("img",{src:B,alt:"speit",id:"back"})],-1),$={id:"log"},E=o("div",{class:"center",id:"title"},[o("h2",null,"登录"),o("h2",null,"Connexion")],-1),M={key:0},z={class:"center"},F=o("br",null,null,-1),R={class:"center"},D={key:1},H={class:"center",id:"in"},q={class:"center"},G=o("br",null,null,-1),K={class:"center"},O=o("br",null,null,-1);function Q(c,t,l,e,p,m){const n=w("el-button"),i=w("JAccountLogin");return d(),g(j,null,[V,o("div",$,[E,e.showInput?f("",!0):(d(),g("div",M,[o("div",z,[u(n,{type:"primary",class:"login-button",onClick:t[0]||(t[0]=s=>e.showInput=!e.showInput)},{default:_(()=>[r("管理员登录"),F,r("Connexion Administrateur")]),_:1})]),o("div",R,[u(i)])])),e.showInput?(d(),g("div",D,[o("div",H,[P(o("input",{id:"myInput",type:"text",placeholder:"密码 Mot de passe","onUpdate:modelValue":t[1]||(t[1]=s=>e.password=s)},null,512),[[S,e.password]])]),o("div",q,[u(n,{type:"primary",class:"login-button",onClick:t[2]||(t[2]=s=>e.enter())},{default:_(()=>[r("登录"),G,r("Connexion")]),_:1})]),o("div",K,[u(n,{type:"primary",class:"login-button",onClick:t[3]||(t[3]=s=>e.showInput=!e.showInput)},{default:_(()=>[r("返回"),O,r("Retour")]),_:1})])])):f("",!0)])],64)}const Y=J(U,[["render",Q]]);export{Y as default};
